{"version":3,"file":"previewAction.js","sources":["../../src/_internal/cli/actions/preview/previewAction.ts"],"sourcesContent":["import path from 'node:path'\n\nimport {type CliCommandArguments, type CliCommandContext, type CliConfig} from '@sanity/cli'\n\nimport {type PreviewServerOptions, startPreviewServer} from '../../server'\nimport {getSharedServerConfig, gracefulServerDeath} from '../../util/servers'\n\nexport interface StartPreviewServerCommandFlags {\n  host?: string\n  port?: string\n}\n\nexport default async function startSanityPreviewServer(\n  args: CliCommandArguments<StartPreviewServerCommandFlags>,\n  context: CliCommandContext,\n): Promise<void> {\n  const flags = args.extOptions\n  const {workDir, cliConfig} = context\n\n  const defaultRootDir = path.resolve(path.join(workDir, 'dist'))\n  const rootDir = path.resolve(args.argsWithoutOptions[0] || defaultRootDir)\n  const config = getPreviewServerConfig({flags, workDir, cliConfig, rootDir})\n\n  try {\n    await startPreviewServer(config)\n  } catch (err) {\n    gracefulServerDeath('preview', config.httpHost, config.httpPort, err)\n  }\n}\n\nfunction getPreviewServerConfig({\n  flags,\n  workDir,\n  cliConfig,\n  rootDir,\n}: {\n  flags: StartPreviewServerCommandFlags\n  rootDir: string\n  workDir: string\n  cliConfig?: CliConfig\n}): PreviewServerOptions {\n  const baseConfig = getSharedServerConfig({flags, workDir, cliConfig})\n  return {\n    ...baseConfig,\n    root: rootDir,\n  }\n}\n"],"names":["startSanityPreviewServer","args","context","flags","extOptions","workDir","cliConfig","defaultRootDir","path","resolve","join","rootDir","argsWithoutOptions","config","getPreviewServerConfig","startPreviewServer","err","gracefulServerDeath","httpHost","httpPort","getSharedServerConfig","root"],"mappings":";;;;;;;;AAY8BA,eAAAA,yBAC5BC,MACAC,SACe;AACTC,QAAAA,QAAQF,KAAKG,YACb;AAAA,IAACC;AAAAA,IAASC;AAAAA,EAAAA,IAAaJ,SAEvBK,iBAAiBC,sBAAKC,QAAQD,cAAAA,QAAKE,KAAKL,SAAS,MAAM,CAAC,GACxDM,UAAUH,sBAAKC,QAAQR,KAAKW,mBAAmB,CAAC,KAAKL,cAAc,GACnEM,SAASC,uBAAuB;AAAA,IAACX;AAAAA,IAAOE;AAAAA,IAASC;AAAAA,IAAWK;AAAAA,EAAAA,CAAQ;AAEtE,MAAA;AACF,UAAMI,cAAAA,mBAAmBF,MAAM;AAAA,WACxBG,KAAK;AACZC,YAAAA,oBAAoB,WAAWJ,OAAOK,UAAUL,OAAOM,UAAUH,GAAG;AAAA,EAAA;AAExE;AAEA,SAASF,uBAAuB;AAAA,EAC9BX;AAAAA,EACAE;AAAAA,EACAC;AAAAA,EACAK;AAMF,GAAyB;AAEhB,SAAA;AAAA,IACL,GAFiBS,8BAAsB;AAAA,MAACjB;AAAAA,MAAOE;AAAAA,MAASC;AAAAA,IAAAA,CAAU;AAAA,IAGlEe,MAAMV;AAAAA,EACR;AACF;;"}