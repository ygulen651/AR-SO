{"version":3,"file":"deleteAspectAction.js","sources":["../../src/_internal/cli/actions/media/deleteAspectAction.ts"],"sourcesContent":["import {type CliCommandAction} from '@sanity/cli'\nimport {MEDIA_LIBRARY_ASSET_ASPECT_TYPE_NAME} from '@sanity/types'\nimport {tap} from 'rxjs'\n\nimport {MINIMUM_API_VERSION} from './constants'\nimport {determineTargetMediaLibrary} from './lib/determineTargetMediaLibrary'\n\ninterface DeleteAspectFlags {\n  'media-library-id'?: string\n  'aspect-name'?: string\n}\n\nconst deleteAspectAction: CliCommandAction<DeleteAspectFlags> = async (args, context) => {\n  const {output, chalk, apiClient, prompt} = context\n  const [aspectName] = args.argsWithoutOptions\n\n  if (typeof aspectName === 'undefined') {\n    output.error('Specify an aspect name.')\n    return\n  }\n\n  const mediaLibraryId =\n    args.extOptions['media-library-id'] ?? (await determineTargetMediaLibrary(context))\n\n  const confirmedDelete = await prompt.single({\n    type: 'confirm',\n    message: `Are you absolutely sure you want to undeploy the ${aspectName} aspect from the \"${mediaLibraryId}\" media library?`,\n    default: false,\n  })\n\n  if (!confirmedDelete) {\n    return\n  }\n\n  const client = apiClient().withConfig({apiVersion: MINIMUM_API_VERSION})\n\n  client.observable\n    .request({\n      method: 'POST',\n      uri: `/media-libraries/${mediaLibraryId}/mutate`,\n      body: {\n        mutations: [\n          {\n            delete: {\n              query: `*[_type == $type && _id == $id]`,\n              params: {\n                id: aspectName,\n                type: MEDIA_LIBRARY_ASSET_ASPECT_TYPE_NAME,\n              },\n            },\n          },\n        ],\n      },\n    })\n    .pipe(\n      tap({\n        error(error) {\n          output.print()\n          output.error(chalk.bold('Failed to delete aspect'))\n          output.print(`  - ${aspectName}`)\n          output.print()\n          output.print(chalk.red(error.message))\n        },\n        next(response) {\n          if (response.results.length === 0) {\n            output.print()\n            output.warn(chalk.bold(`There's no deployed aspect with that name`))\n            output.print(`  - ${aspectName}`)\n            return\n          }\n\n          output.print()\n          output.success(chalk.bold(`Deleted aspect`))\n          output.print(`  - ${aspectName}`)\n        },\n      }),\n    )\n    .subscribe()\n\n  // TODO: Find existing aspect definition files matching the undeployed aspect name and offer\n  // to delete them.\n}\n\nexport default deleteAspectAction\n"],"names":["deleteAspectAction","args","context","output","chalk","apiClient","prompt","aspectName","argsWithoutOptions","error","mediaLibraryId","extOptions","determineTargetMediaLibrary","single","type","message","default","withConfig","apiVersion","MINIMUM_API_VERSION","observable","request","method","uri","body","mutations","delete","query","params","id","MEDIA_LIBRARY_ASSET_ASPECT_TYPE_NAME","pipe","tap","print","bold","red","next","response","results","length","warn","success","subscribe"],"mappings":";;AAYMA,MAAAA,qBAA0D,OAAOC,MAAMC,YAAY;AACjF,QAAA;AAAA,IAACC;AAAAA,IAAQC;AAAAA,IAAOC;AAAAA,IAAWC;AAAAA,EAAUJ,IAAAA,SACrC,CAACK,UAAU,IAAIN,KAAKO;AAEtB,MAAA,OAAOD,aAAe,KAAa;AACrCJ,WAAOM,MAAM,yBAAyB;AACtC;AAAA,EAAA;AAGF,QAAMC,iBACJT,KAAKU,WAAW,kBAAkB,KAAM,MAAMC,wDAA4BV,OAAO;AAQ/E,EANoB,MAAMI,OAAOO,OAAO;AAAA,IAC1CC,MAAM;AAAA,IACNC,SAAS,oDAAoDR,UAAU,qBAAqBG,cAAc;AAAA,IAC1GM,SAAS;AAAA,EAAA,CACV,KAMcX,UAAAA,EAAYY,WAAW;AAAA,IAACC,YAAYC,4BAAAA;AAAAA,EAAAA,CAAoB,EAEhEC,WACJC,QAAQ;AAAA,IACPC,QAAQ;AAAA,IACRC,KAAK,oBAAoBb,cAAc;AAAA,IACvCc,MAAM;AAAA,MACJC,WAAW,CACT;AAAA,QACEC,QAAQ;AAAA,UACNC,OAAO;AAAA,UACPC,QAAQ;AAAA,YACNC,IAAItB;AAAAA,YACJO,MAAMgB,MAAAA;AAAAA,UAAAA;AAAAA,QACR;AAAA,MAEH,CAAA;AAAA,IAAA;AAAA,EAEL,CACD,EACAC,KACCC,SAAI;AAAA,IACFvB,MAAMA,OAAO;AACJwB,aAAAA,MAAAA,GACP9B,OAAOM,MAAML,MAAM8B,KAAK,yBAAyB,CAAC,GAClD/B,OAAO8B,MAAM,OAAO1B,UAAU,EAAE,GAChCJ,OAAO8B,SACP9B,OAAO8B,MAAM7B,MAAM+B,IAAI1B,MAAMM,OAAO,CAAC;AAAA,IACvC;AAAA,IACAqB,KAAKC,UAAU;AACTA,UAAAA,SAASC,QAAQC,WAAW,GAAG;AACjCpC,eAAO8B,MAAM,GACb9B,OAAOqC,KAAKpC,MAAM8B,KAAK,2CAA2C,CAAC,GACnE/B,OAAO8B,MAAM,OAAO1B,UAAU,EAAE;AAChC;AAAA,MAAA;AAGFJ,aAAO8B,MAAM,GACb9B,OAAOsC,QAAQrC,MAAM8B,KAAK,gBAAgB,CAAC,GAC3C/B,OAAO8B,MAAM,OAAO1B,UAAU,EAAE;AAAA,IAAA;AAAA,EAClC,CACD,CACH,EACCmC,UAAU;AAIf;;"}